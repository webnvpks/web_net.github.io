<title>AJAX XMLHttpRequest</title>
<link rel="shortcut icon" href="../../img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../css/css.css">
<meta charset="utf-8">
<script src="../../js/jquery-3.3.1.min.js"></script>
<script src="../../js/vision_js.js"></script><script src="../../js/slide_js.js"></script>
<div class="body">
    <p class="vision" title="Версия для слабовидящих" onclick="cl()">
        <svg width="50" height="50" viewBox="0 0 1750 1750" xmlns="http://www.w3.org/2000/svg">
            <path fill="#ffffff"
                d="M1664 960q-152-236-381-353 61 104 61 225 0 185-131.5 316.5t-316.5 131.5-316.5-131.5-131.5-316.5q0-121 61-225-229 117-381 353 133 205 333.5 326.5t434.5 121.5 434.5-121.5 333.5-326.5zm-720-384q0-20-14-34t-34-14q-125 0-214.5 89.5t-89.5 214.5q0 20 14 34t34 14 34-14 14-34q0-86 61-147t147-61q20 0 34-14t14-34zm848 384q0 34-20 69-140 230-376.5 368.5t-499.5 138.5-499.5-139-376.5-368q-20-35-20-69t20-69q140-229 376.5-368t499.5-139 499.5 139 376.5 368q20 35 20 69z">
            </path>
        </svg>
    </p>
</div>
<div class="header"></div>
<div class="hat"><div class="sandwich" onclick="OpenMenu()">>>></div>
    <p class="name">
        Проектирование, разработка и оптимизация веб-приложений
    </p>
    <div class="links">
        <a href="../../../index.html" class="link">Главная</a>
        <a href="../lectures.html" class="link" title="Лекции">Лекции</a>
        <a href="../video.html" class="link" title="Видео-уроки">Видео-уроки</a>
        <a href="../laboratornie.html" class="link" title="Лабораторные работы">Лабораторные работы</a>
        <a href="../tests.html" class="link" title="Тесты">Тесты</a>
    </div>
</div>
<div class="content">
    <h1>Объект XMLHttpRequest</h1>
    <p>Объект <tt>XMLHttpRequest</tt> позволяет получать данные с сервера в фоновом
        режиме.
        Как правило, возвращаемая информация представляется в формате XML, но данный объект
        также позволяет работать с любыми текстовыми данными. Объект <tt>XMLHttpRequest</tt>
        впервые был реализован компанией Microsoft в виде объекта <tt>ActiveX</tt>.
        Сейчас он уже доступен в
        браузерах Mozilla, Netscape (начиная с 7-ой версии) а также в Safari (с версии 1.2),
        естественно, не в виде ActiveX-компоненты. Объект <tt>XMLHttpRequest</tt>
        представляет собой набор API функций, используемый в JavaScript, VBScipt и т.п. для
        передачи данных XML по протоколу HTTP.
    </p>
    <p>Ниже представлены методы и свойства объекта <tt>XMLHttpRequest</tt>, общие для
        Internet Explorer 5+, Mozilla, Netscape 7 и Safari 1.2.

    </p>
    <h3>Методы объекта XMLHttpRequest:</h3>
    <ul>
        <li><b>abort( )</b>. Обрывает текущий запрос.
            <p>Для браузера Internet Explorer успешный вызов abort() на самом деле может не обрывать соединение, а
                оставлять его в подвешенном
                состоянии на некоторый таймаут (~30 секунд).
                У браузера есть лимит: не более 2 одновременных соединений с одним доменом. Т.е, если два соединения
                уже висят, то третье открыто не будет, пока одно из них не умрет.

            </p>
        </li>
        <li><b>getAllResponseHeaders( )</b>. Возвращает полный набор заголовков ответа (названий и значений)
            в виде строки.

        </li>
        <li><b>getResponseHeader(&lt;headerLabel&gt;)</b>. Возвращает строковое значение заголовка,
            название которого указано в параметре headerLabel.
            Если параметр не задан, возвращает весь заголовок.
            Например: <code>http.getResponseHeader("Last-Modified");</code>

        </li>
        <li><b>open(&lt;method&gt;, &lt;URL&gt; [, &lt;asyncFlag&gt;[, &lt;userName&gt;[, &lt;password&gt;]]])</b>.
            Открывает соединение с сервером с указанием метода
            передачи данных.
            <p>method: <b>GET</b>, <b>POST</b>, <b>HEAD</b>, <b>TRACE</b>, <b>DELETE</b>, <b>PUT</b>;
            </p>
            <p>URL: адрес запроса. Можно использовать не только HTTP или HTTPS, но и другие протоколы,
                такие как FTP и file://. При этом запрос со страницы можно отправлять только на тот домен и порт,
                с которого она пришла. Как обойти это ограничение описано в разделе <a style="color:blue;"
                    target="_blank" href="ajax7.html">Ошибки Ajax</a>.
            </p>
            <p>asyncFlag: флага асинхронности:
                <tt>false</tt> - синхронно (скрипт будет ожидать ответа от сервера),
                <tt>true</tt> - асинхронно (по умолчанию);
            </p>
            <p>userName, password: логин и пароль для простой HTTP-авторизации.

            </p>
        </li>
        <li><b>send(&lt;content&gt;)</b>. Отправка запроса. Значением content могут быть
            данные для POST-запроса или пустая строка.

        </li>
        <li><b>setRequestHeader(&lt;label&gt;, &lt;value&gt;)</b>.
            Установка в отправляемом запросе заголовка <b>label</b> со значением <b>value</b>.
            Если заголовок с таким name уже есть - он заменяется. Например,

            <code>http.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
http.setRequestHeader('Content-type', 'text/xml')<br>
</code>

        </li>
        <li><b>timeout</b> - время выполнения запроса в милисекундах, например
            <code>http.timeout = 10000; // 10 sec</code></li>
        <li><b>ontimeout</b> - обработка события "время ожидания ответа истекло", например
            <code>http.ontimeout = function(){hide('wait');alert("Время выполнения запроса истекло!");};</code></li>
        <li><b>ontimeout</b> - обработка события "ошибка", например
            <code>http.onerror = function(){hide('wait');alert("Ошибка выполнения запроса!");};</code></li>

    </ul>
    <h3>Свойства объекта XMLHttpRequest:</h3>
    <ul>
        <li><b>onreadystatechange</b>. Событие, возникающее при смене статуса объекта.
        </li>
        <li><b>readyState</b>. Значения статуса. Может принимать следующие значения:
            <ul>
                <li>0 - не инициализирован (перед началом работы объекта),</li>
                <li>1 - загрузка (однажды, когда идет инициализация объекта),</li>
                <li>2 - загружен (однажды, когда получен ответ от сервера),</li>
                <li>3 - доступен (пока объект соединен с сервером),</li>
                <li>4 - завершен (после того, как объект выполнил все задачи).</li>
            </ul>
        </li>
        <li><b>responseText</b>. Строка с возвращенными сервером данными.
        </li>
        <li><b>responseXML</b>. DOM-совместимый объект-документ с возвращенными сервером данными.
            Например,<br>
            <code>var authorElem = xmlhttp.responseXML.getElementById('author')</code><br>
            Чтобы браузер успешно обработал ответ сервера в свойство responseXML,
            в заголовок ответа должен содержать: "Content-Type: text/xml".
            Иначе свойство responseXML будет равно null.
        </li>
        <li><b>status</b>. Стандартный HTTP-код статуса</a>.
            Например, 404 (для "Not Found") или 200 (для "OK").<br>
            Запросы по протоколам FTP, file:// не возвращают статуса, поэтому нормальным для них является status=0.</li>
        <li><b>statusText</b>. Текстовое сообщение статуса, например "Not Found" или "OK".</li>
    </ul>
    <p>Общий план работы с объектом <strong>XMLHttpRequest</strong> можно представить следующим образом:
    </p>
    <ol>
        <li>Создание экземпляра объекта <strong>XMLHttpRequest</strong>.
        </li>
        <li>Установка обработчика события <strong>onreadystatechange</strong>.
        </li>
        <li>Открытие соединения с сервером методом <strong>open</strong>.
        </li>
        <li>Непосредственно отправка запроса методом <strong>send</strong>.
        </li>
    </ol>

    <h4>Пример</h4>
    <pre class="adb"><code class="language-html javascript"><span class="keyword">var</span> ajaxObj;
<span class="keyword">if</span>(window.XMLHttpRequest){
    ajaxObj = <span class="keyword">new</span> XMLHttpRequest();
} <span class="keyword">else</span> <span class="keyword">if</span>(window.ActiveXObject){
    ajaxObj = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);
} <span class="keyword">else</span> {
    <span class="keyword">return</span> <span class="literal">false</span>;
}
ajaxObj.open((post?<span class="string">'POST'</span>:<span class="string">'GET'</span>), <span class="string">'https://htmlweb.ru/api.php'</span>);
ajaxObj.setRequestHeader(<span class="string">"Content-Type"</span>,
            <span class="string">"application/x-www-form-urlencoded; charset=utf-8;"</span>);
ajaxObj.onreadystatechange =<span class="keyword">function</span>(){
    <span class="keyword">if</span>(ajaxObj.readyState==<span class="number">4</span> &amp;&amp; ajaxObj.status==<span class="number">200</span>){
        console.log(<span class="string">'Статус:'</span>+ajaxObj.status+<span class="string">', ответ:'</span>+ajaxObj.statusText);
    }
};
ajaxObj.timeout = <span class="number">10000</span>; <span class="comment">// 10 sec</span>
ajaxObj.ontimeout = <span class="keyword">function</span>(){hide(<span class="string">'wait'</span>);alert(<span class="string">"Время выполнения запроса истекло!"</span>);};
ajaxObj.onerror = <span class="keyword">function</span>(){hide(<span class="string">'wait'</span>);alert(<span class="string">"Ошибка выполнения запроса!"</span>);};
ajaxObj.send(post);
<span class="keyword">return</span> <span class="literal">false</span>;</code></pre>
    <div class="next"><a href="ajax3.html">Следующая лекция</a></div><br>
</div>
<div id="vis">
    <div class="font">
        Размер шрифта:</div>
    <div class="fontA" onclick="fonta()">А</div>
    <div class="fontAA" onclick="fontaa()">А</div>
    <div class="fontAAA" onclick="fontaaa()">А</div>
    <div class="color">Цвет сайта:</div>
    <div class="colorW" onclick="clwhite()">A</div>
    <div class="colorBK" onclick="clblack()">A</div>
    <div class="colorBE" onclick="clblue()">A</div>
    <div class="imgOnOff">Изображение:</div>
    <div class="imgOn" onclick="imgon()">Вкл.</div>
    <div class="imgOff" onclick="imgoff()">Выкл.</div>
    <div id="exit" onclick="clc()" title="Закрыть">Обычная версия</div>
</div>